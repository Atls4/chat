<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Main page</title>
</head>
<body>
    <form action="">
        <button id="logout">Logout</button>
    </form>
    <input id="chatField" type="text">
    <button id='chatSend'>Click</button>
    <ul id="messages"></ul>
    <h4 id="placeholder">Placeholder</h3>

    <!--JQUERY-->
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <!--PAGE SCRIPTS-->
    <script>
        $(()=>{
            //LOGOUT BUTTON LISTENER
            document.getElementById('logout').addEventListener('click', () => {
                console.log('Delete cookies');
                deleteCookies();
                
            });
            //DELETE COOKIES FUNCTION
            function deleteCookies(){
                let cookies = document.cookie.split(";");
    
                cookies.forEach(cookie => { //MAGIC
                    let currentCookie = cookie;
                    let eqPos = currentCookie.indexOf("=");
                    let name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
                    document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
                    
                });
            }
        });
    </script>
    <!--CHAT SCRIPTS-->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        $(()=>{
            const socket = io();
            //SEND BUTTON LISTENER
            $('#chatSend').on('click', ()=>{

                let text = $('#chatField').val();
                let token = document.cookie.split(';');

                for (let i = 0; i < token.length; i++) {
                    token[i] = token[i].trim();
                    
                }

                let sendToken = token.filter( c => c.startsWith('JWTtoken')).toString().replace("JWTtoken=","");                
                let message = {
                    text: text,
                    token: sendToken,
                    color: undefined || 'grey'
                }
                
                socket.emit('send_message', message); //SEND MESSAGE
                console.log('A message has been sent');
                
                return false;
            });
            //RECEIVE MESSAGE
            socket.on('get_message', function(message){
                console.log('A message has been received');
                switch(message.type){
                    case "standard": {
                        //APPEND MESSAGE TO DOC
                        $('#messages').append($('<li>').text('' + message.username + " : " + message.text)); 
                        /*ADD COLOR AND BADGES IN FUTURE [REACT]*/
                    }
                    break;
                    case "command": {
                        $('#placeholder').text('Command' + message.type + " : " + message.text); 
                    }
                    break;
                    case "error": {
                        $('#placeholder').text('Error' + message.type + " : " + message.text); 
                    }
                    break;
                    default: {
                        $('#messages').append($('<li>').text('' + message.username + " : " + message.text)); 
                    }
                    break;
                }
            });
        });
    </script>
</body>
</html>
